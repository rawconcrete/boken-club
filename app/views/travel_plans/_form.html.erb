<div class="container-fluid px-4"
     data-controller="travel-plan"
     data-travel-plan-locations-value="<%= travel_plan.locations.to_json %>"
     data-travel-plan-adventures-value="<%= travel_plan.adventures.reject(&:nil?).to_json %>">
  <%= form_with(model: travel_plan, local: true, data: { action: "submit->travel-plan#formSubmit" }) do |f| %>

<!-- Layout Grid -->
    <div class="row">
      <!-- Left Sidebar - Skills -->
      <div class="col-md-3">
        <div class="sticky-sidebar">
          <div class="card compact-card specific-card"
               data-controller="skills-recommendation"
               data-skills-recommendation-travel-plan-id-value="<%= travel_plan.persisted? ? travel_plan.id : 0 %>"
               data-skills-recommendation-selected-skill-ids-value="<%= travel_plan.skill_ids.to_json %>">
            <div class="card-header">
              <h5 class="mb-0">Recommended Skills</h5>
              <p class="text-muted small mb-0">Click "Add to Plan" to include skills you want to learn or reference for this trip.</p>
            </div>
            <div class="card-body p-2">
              <div data-skills-recommendation-target="skillsList">
                <div class="alert alert-info">
                  <p>Select locations and adventures to see recommended skills.</p>
                  <% word = travel_plan.skills.count == 1 ? "skill" : "skills" %>
                  <% string = "You have #{travel_plan.skills.count} #{word} already selected." %>
                  <% if travel_plan.skills.any? %>
                    <p><%= word %></p>
                  <% end %>
                </div>
              </div>
              <div id="selected-skills-container" style="display: none;">
                <% travel_plan.skill_ids.each do |skill_id| %>
                  <input type="hidden" name="travel_plan[skill_ids][]" value="<%= skill_id %>">
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div class="col-md-7">
        <!-- Trip Dates -->
        <div class="card compact-card specific-card">
          <div class="card-header">
          <h5 class="mb-0 p-2">Trip Dates</h5>
          </div>
          <div class="card-body p-3">
            <div class="row g-2">
              <div class="col-md-6">
                <%= f.label :start_date, class: "form-label small" %>
                <%= f.date_field :start_date,
                      class: "form-control form-control-sm",
                      data: { travel_plan_target: "startDate", action: "change->travel-plan#updateEquipment" } %>
              </div>
              <div class="col-md-6">
                <%= f.label :end_date, class: "form-label small" %>
                <%= f.date_field :end_date, class: "form-control form-control-sm", data: { travel_plan_target: "endDate" } %>
              </div>
            </div>
          </div>
        </div>

        <!-- Plan Details -->
        <div class="card compact-card specific-card">
          <div class="card-header">
          <h5 class="mb-0 p-2">Plan Details</h5>
          </div>
          <div class="card-body p-2">
            <%= f.label :title, class: "form-label small" %>
            <%= f.text_field :title, class: "form-control form-control-sm" %>

            <%= f.label :content, class: "form-label small mt-2" %>
            <%= f.text_area :content, class: "form-control form-control-sm", rows: 3 %>
          </div>
        </div>

        <%# adventures card %>
    <div class="card compact-card mb-4 specific-card">
      <div class="card-header">
        <h5 class="mb-0 p-2">Available Adventures</h5>
      </div>
      <div class="card-body">
        <div data-travel-plan-target="selectedAdventures" class="mb-3"></div>
        <input type="text"
               class="form-control"
               placeholder="Search adventures..."
               data-travel-plan-target="adventureSearch"
               data-action="input->travel-plan#searchAdventures">
        <div data-travel-plan-target="adventureResults" class="list-group mt-2"></div>
      </div>
    </div>

        <!-- Locations -->
        <div class="card compact-card specific-card">
          <div class="card-header">
          <h5 class="mb-0 p-2">Locations</h5>
          </div>
          <div class="card-body p-2">
          <div data-travel-plan-target="selectedLocations" class="mb-3">
          </div>
            <input type="text"
                   class="form-control form-control-sm"
                   placeholder="Search locations..."
                   data-travel-plan-target="locationSearch"
                   data-action="input->travel-plan#searchLocations">
            <div data-travel-plan-target="locationResults" class="list-group mt-2"></div>
          </div>
        </div>
      </div>

      <!-- Right Sidebar - Equipment -->
      <div class="col-md-2">
        <div class="sticky-sidebar">
          <div class="card compact-card specific-card">
            <div class="card-header">
            <h5 class="mb-0">Recommended Equipment</h5>
            </div>
            <div class="card-body p-2">
              <div class="equipment-list" data-travel-plan-target="equipmentList">
                <%# Equipment will be dynamically inserted here %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Save Button -->
    <div class="d-flex justify-content-end gap-2 mt-3 mb-4">
      <%= link_to 'Cancel', :back, class: "btn btn-sm btn-secondary" %>
      <%= f.submit 'Save', class: "btn btn-sm btn-primary" %>
    </div>

  <% end %>
</div>
