<div class="container"
     data-controller="travel-plan"
     data-travel-plan-locations-value="<%= travel_plan.locations.to_json %>"
     data-travel-plan-adventures-value="<%= travel_plan.adventures.reject(&:nil?).to_json %>">
  <%= form_with(model: travel_plan, local: true, data: { action: "submit->travel-plan#formSubmit" }) do |f| %>

    <!-- Layout Grid -->
    <div class="row">
      <!-- Left Sidebar - Skills -->
      <div class="col-md-3">
        <div class="sticky-sidebar">
          <div class="card compact-card specific-card">
            <div class="card-header">Recommended Skills</div>
            <div class="card-body p-2">
              <div data-skills-recommendation-target="skillsList">
                <div class="alert alert-info small">Select locations and adventures to see recommended skills.</div>
              </div>
              <div id="selected-skills-container">
                <% travel_plan.skill_ids.each do |skill_id| %>
                  <input type="hidden" name="travel_plan[skill_ids][]" value="<%= skill_id %>">
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div class="col-md-6">
        <!-- Trip Dates -->
        <div class="card compact-card specific-card">
          <div class="card-header">Trip Dates</div>
          <div class="card-body p-2">
            <div class="row g-2">
              <div class="col-md-6">
                <%= f.label :start_date, class: "form-label small" %>
                <%= f.date_field :start_date,
                      class: "form-control form-control-sm",
                      data: { travel_plan_target: "startDate", action: "change->travel-plan#updateEquipment" } %>
              </div>
              <div class="col-md-6">
                <%= f.label :end_date, class: "form-label small" %>
                <%= f.date_field :end_date, class: "form-control form-control-sm", data: { travel_plan_target: "endDate" } %>
              </div>
            </div>
          </div>
        </div>

        <!-- Plan Details -->
        <div class="card compact-card specific-card">
          <div class="card-header">Plan Details</div>
          <div class="card-body p-2">
            <%= f.label :title, class: "form-label small" %>
            <%= f.text_field :title, class: "form-control form-control-sm" %>

            <%= f.label :content, class: "form-label small mt-2" %>
            <%= f.text_area :content, class: "form-control form-control-sm", rows: 3 %>
          </div>
        </div>

        <!-- Available Adventures -->
        <div class="card compact-card specific-card">
          <div class="card-header">Available Adventures</div>
          <div class="card-body p-2">
            <input type="text"
                   class="form-control form-control-sm"
                   placeholder="Search adventures..."
                   data-travel-plan-target="adventureSearch"
                   data-action="input->travel-plan#searchAdventures">
            <div data-travel-plan-target="adventureResults" class="list-group mt-2"></div>
          </div>
        </div>

        <!-- Locations -->
        <div class="card compact-card specific-card">
          <div class="card-header">Locations</div>
          <div class="card-body p-2">
            <input type="text"
                   class="form-control form-control-sm"
                   placeholder="Search locations..."
                   data-travel-plan-target="locationSearch"
                   data-action="input->travel-plan#searchLocations">
            <div data-travel-plan-target="locationResults" class="list-group mt-2"></div>
          </div>
        </div>
      </div>

      <!-- Right Sidebar - Equipment -->
      <div class="col-md-3">
        <div class="sticky-sidebar">
          <div class="card compact-card specific-card">
            <div class="card-header">Recommended Equipment</div>
            <div class="card-body p-2">
              <div class="equipment-list" data-travel-plan-target="equipmentList">
                <%# Equipment will be dynamically inserted here %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Save Button -->
    <div class="d-flex justify-content-end gap-2 mt-3">
      <%= link_to 'Cancel', :back, class: "btn btn-sm btn-secondary" %>
      <%= f.submit 'Save', class: "btn btn-sm btn-primary" %>
    </div>

  <% end %>
</div>
